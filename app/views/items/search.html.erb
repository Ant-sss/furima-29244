<%= render "shared/header" %>

<div class='main'>
  <div class='nav'>
    探す
    <ul class='lists-left'>
    <%= search_form_for @p, url: search_items_path do |f| %>
      <li>カテゴリー<%= f.collection_select(:category_id_eq, Category.all, :id, :name, {}, {class: "select-box"}) %></li>
      <li>商品の状態<%= f.collection_select(:status_id_eq, Status.all, :id, :name, {}, {class:"select-box", id:"item-sales-status"}) %></li>
      <li>配送料の負担<%= f.collection_select(:deliveryfee_id_eq, Deliveryfee.all, :id, :name, {}, {class:"select-box", id:"item-shipping-fee-status"}) %></li>
      <br>
      <%= f.submit '検索',class:"search-btn"%>
    <% end %>
      <%# <li><%= link_to 'ブランド', "#", class: "brand-list" %></li> 
    </ul>
  </div>

  <%# 商品一覧 %>
  <div class='item-contents'>
    <h2 class='title'>検索結果</h2>
      <%# <%= link_to '検索結果', "#", class: "subtitle"  %>

    <ul class='item-lists'>
      
      <% if @search_items.present? && @results.length == 0 %>
        <% @search_items.each do |item| %> 
          <li class='list'>
            <%= link_to item_path(item.id) do %>
              <div class='item-img-content'>
                <%= image_tag item.image, class: "item-img" %>

                <% @buy.each do |buy| %>
                  <% if buy.item_id == item.id %>
                    <div class='sold-out'>
                      <span>Sold Out!!</span>
                    </div>
                  <% end %>
                <% end %>

              </div>
              <div class='item-info'>
                <h3 class='item-name'>
                  <%= item.name %>
                </h3>
                <div class='item-price'>
                  <span><%= item.price %>円<br>(税込み)</span>
                  <div class='star-btn'>
                    <%= image_tag "star.png", class:"star-icon" %>
                    <span class='star-count'>0</span>
                  </div>
                </div>
              </div>
            <% end %>
          </li>
        <% end %>
        <%# <% end %> %>
    
      <% elsif @results.length != 0 %>
        <% @results.each do |result| %>
          <li class='list'>
            <%= link_to item_path(result.id) do %>
              <div class='item-img-content'>
                <%= image_tag result.image, class: "item-img" %>

                <% @buy.each do |buy| %>
                  <% if buy.item_id == result.id %>
                    <div class='sold-out'>
                      <span>Sold Out!!</span>
                    </div>
                  <% end %>
                <% end %>

              </div>
              <div class='item-info'>
                <h3 class='item-name'>
                  <%= result.name %>
                </h3>
                <div class='item-price'>
                  <span><%= result.price %>円<br>(税込み)</span>
                  <div class='star-btn'>
                    <%= image_tag "star.png", class:"star-icon" %>
                    <span class='star-count'>0</span>
                  </div>
                </div>
              </div>
            <% end %>
          </li>
        <% end %>
      <% end %>

      <%# 商品がない場合のダミー %>
      <% unless @search_items.present? %>
        <li class='list'>
          <%= link_to '#' do %>
            <%= image_tag "https://s3-ap-northeast-1.amazonaws.com/mercarimaster/uploads/captured_image/content/10/a004.png", class: "item-img" %>
            <div class='item-info'>
              <h3 class='item-name'>
                商品を出品してね！
              </h3>
              <div class='item-price'>
                <span>99999999円<br>(税込み)</span>
                <div class='star-btn'>
                  <%= image_tag "star.png", class:"star-icon" %>
                  <span class='star-count'>0</span>
                </div>
              </div>
            </div>
          <% end %>
        </li>
      <% end %>
      <%# /商品がない場合のダミー %>
    </ul>
  </div>
  <%# /商品一覧 %>
</div>

<div class='purchase-btn'>
  <span class='purchase-btn-text'>出品する</span>
  <a href="/items/new">
    <%= image_tag 'camera.png' , size: '185x50' ,class: "purchase-btn-icon" %>
  </a>
</div>

<%= render "shared/footer" %>